# From https://hub.docker.com/_/mediawiki

# MediaWiki with MariaDB
#
# Access via "http://localhost:8080"
#   (or "http://$(docker-machine ip):8080" if using docker-machine)

version: '3.7'

services:
  mediawiki:
    image: mediawiki
    restart: unless-stopped

    ports:
      - '5757:80'

    links:
      - mariadb

    volumes:
      - mediawiki_images:/var/www/html/images

      # The comment below is from the original but this might no longer be needed
      # since we have a persistent volume here.
      #
      # After initial setup, download LocalSettings.php to the same directory as
      # this yaml and uncomment the following line and use compose to restart
      # the mediawiki service
      # - ./LocalSettings.php:/var/www/html/LocalSettings.php

  mariadb:
    image: mariadb

    restart: unless-stopped

    environment:
      PUID: 1000
      PGID: 1000
      TZ: Europe/Amsterdam

      MYSQL_DATABASE: mediawiki
      MYSQL_USER: mediawiki
      MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
      MYSQL_PASSWORD: '${DB_USER_PASSWORD:?DB_USER_PASSWORD must be set}'

    volumes:
      - mediawiki_config:/config

volumes:
  mediawiki_config:
  mediawiki_images:
